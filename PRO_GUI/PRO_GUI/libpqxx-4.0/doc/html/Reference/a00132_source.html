<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libpqxx: cursor.hxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libpqxx&#160;<span id="projectnumber">4.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('a00132.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">cursor.hxx</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *   FILE</span>
<a name="l00004"></a>00004 <span class="comment"> *      pqxx/cursor.hxx</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> *   DESCRIPTION</span>
<a name="l00007"></a>00007 <span class="comment"> *      definition of the iterator/container-style cursor classes</span>
<a name="l00008"></a>00008 <span class="comment"> *   C++-style wrappers for SQL cursors</span>
<a name="l00009"></a>00009 <span class="comment"> *   DO NOT INCLUDE THIS FILE DIRECTLY; include pqxx/cursor instead.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Copyright (c) 2004-2011, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * See COPYING for copyright license.  If you did not receive a file called</span>
<a name="l00014"></a>00014 <span class="comment"> * COPYING with this source code, please notify the distributor of this mistake,</span>
<a name="l00015"></a>00015 <span class="comment"> * or contact the author.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *-------------------------------------------------------------------------</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef PQXX_H_CURSOR</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_H_CURSOR</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;pqxx/compiler-public.hxx&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;pqxx/compiler-internal-pre.hxx&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef PQXX_HAVE_LIMITS</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;pqxx/result&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;pqxx/transaction_base&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">namespace </span>pqxx
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037 <span class="keyword">class </span>dbtransaction;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00041"></a>00041 
<a name="l00052"></a><a class="code" href="a00030.html">00052</a> <span class="keyword">class </span>PQXX_LIBEXPORT <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054 <span class="keyword">public</span>:
<a name="l00055"></a><a class="code" href="a00030.html#a732bb16c01dc3266d424267252d4f1b0">00055</a>   <span class="keyword">typedef</span> <a class="code" href="a00082.html#a9e02bbf1126802fd7fd64df989e03940">result::size_type</a> <a class="code" href="a00030.html#a732bb16c01dc3266d424267252d4f1b0">size_type</a>;
<a name="l00056"></a><a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">00056</a>   <span class="keyword">typedef</span> <a class="code" href="a00082.html#abec7f7f4d7ed030f38b2a123b632b818">result::difference_type</a> <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a>;
<a name="l00057"></a>00057 
<a name="l00059"></a>00059 
<a name="l00062"></a><a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30e">00062</a>   <span class="keyword">enum</span> <a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30e" title="Cursor access-pattern policy.">accesspolicy</a>
<a name="l00063"></a>00063   {
<a name="l00065"></a><a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30eaf440221f717464c87f043899cc117cbf">00065</a>     <a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30eaf440221f717464c87f043899cc117cbf" title="Cursor can move forward only.">forward_only</a>,
<a name="l00067"></a><a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30ea7f6c1ed7719885433353a78946b2c5f3">00067</a>     random_access
<a name="l00068"></a>00068   };
<a name="l00069"></a>00069 
<a name="l00071"></a>00071 
<a name="l00074"></a><a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212">00074</a>   <span class="keyword">enum</span> <a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212" title="Cursor update policy.">updatepolicy</a>
<a name="l00075"></a>00075   {
<a name="l00077"></a><a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212a8122c0c4a5eb9c9dbf27ab40a2686eb0">00077</a>     <a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212a8122c0c4a5eb9c9dbf27ab40a2686eb0" title="Cursor can be used to read data but not to write.">read_only</a>,
<a name="l00079"></a><a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212a12fa229ee3e760f1ca86d66304554b63">00079</a>     update
<a name="l00080"></a>00080   };
<a name="l00081"></a>00081 
<a name="l00083"></a>00083 
<a name="l00101"></a><a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330">00101</a>   <span class="keyword">enum</span> <a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330" title="Cursor destruction policy.">ownershippolicy</a>
<a name="l00102"></a>00102   {
<a name="l00104"></a><a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330a3ace6a7a5ca4ec3b486f2f35fd2420b0">00104</a>     <a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330a3ace6a7a5ca4ec3b486f2f35fd2420b0" title="Destroy SQL cursor when cursor object is closed at end of transaction.">owned</a>,
<a name="l00106"></a><a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330a4c37408c49492bfe9f012812226dd1fd">00106</a>     loose
<a name="l00107"></a>00107   };
<a name="l00108"></a>00108 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00117"></a>00117   <span class="keyword">static</span> difference_type all() throw ();                                <span class="comment">//[t81]</span>
<a name="l00119"></a>00119 <span class="comment"></span>
<a name="l00121"></a><a class="code" href="a00030.html#a2a10af042c1ece1f5faf55479ada0319">00121</a>   static <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> next() throw () { <span class="keywordflow">return</span> 1; }                  <span class="comment">//[t81]</span>
<a name="l00123"></a>00123 <span class="comment"></span>
<a name="l00125"></a><a class="code" href="a00030.html#aed642c9d80cddf181853d36c6e8ccb93">00125</a>   <span class="keyword">static</span> <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> <a class="code" href="a00030.html#aed642c9d80cddf181853d36c6e8ccb93" title="Special value: read backwards, one row only.">prior</a>() throw () { <span class="keywordflow">return</span> -1; }                <span class="comment">//[t0]</span>
<a name="l00127"></a>00127 <span class="comment"></span>
<a name="l00129"></a>00129   <span class="keyword">static</span> difference_type backward_all() throw ();                       <span class="comment">//[t0]</span>
<a name="l00130"></a>00130 
<a name="l00132"></a>00132 
<a name="l00134"></a>00134 
<a name="l00139"></a><a class="code" href="a00030.html#ab46d430e0ecfa545ff3764f867654caf">00139</a>   const PGSTD::<span class="keywordtype">string</span> &amp;name() const throw () { <span class="keywordflow">return</span> m_name; }         <span class="comment">//[t81]</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keyword">protected</span>:
<a name="l00142"></a>00142   <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>(<a class="code" href="a00023.html" title="connection_base abstract base class; represents a connection to a database.">connection_base</a> &amp;,
<a name="l00143"></a>00143         <span class="keyword">const</span> PGSTD::string &amp;Name,
<a name="l00144"></a>00144         <span class="keywordtype">bool</span> embellish_name=<span class="keyword">true</span>);
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="a00030.html#a947b286d508fad4a1823f8b13a5ccef3">00146</a>   <span class="keyword">const</span> PGSTD::string <a class="code" href="a00030.html#a947b286d508fad4a1823f8b13a5ccef3">m_name</a>;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="keyword">private</span>:
<a name="l00150"></a>00150   <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>();
<a name="l00152"></a>00152   <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>(<span class="keyword">const</span> <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a> &amp;);
<a name="l00154"></a>00154   <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a> &amp;operator=(<span class="keyword">const</span> <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a> &amp;);
<a name="l00155"></a>00155 };
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a><a class="code" href="a00030.html#a56b530ba6b18f3fcdb5b93a0087922c9">00158</a> <span class="keyword">inline</span> <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">cursor_base::difference_type</a> <a class="code" href="a00030.html#a56b530ba6b18f3fcdb5b93a0087922c9" title="Special value: read until end.">cursor_base::all</a>() throw ()
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160 <span class="preprocessor">#ifdef PQXX_HAVE_LIMITS</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>  <span class="keywordflow">return</span> PGSTD::numeric_limits&lt;int&gt;::max()-1;
<a name="l00162"></a>00162 <span class="preprocessor">#else</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>  <span class="keywordflow">return</span> INT_MAX-1;
<a name="l00164"></a>00164 <span class="preprocessor">#endif</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>}
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="a00030.html#ae1e1a28e596a78fa8ed8c4eeccbe6369">00167</a> <span class="keyword">inline</span> <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">cursor_base::difference_type</a> <a class="code" href="a00030.html#ae1e1a28e596a78fa8ed8c4eeccbe6369" title="Special value: read backwards from current position back to origin.">cursor_base::backward_all</a>() throw ()
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169 <span class="preprocessor">#ifdef PQXX_HAVE_LIMITS</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>  <span class="keywordflow">return</span> PGSTD::numeric_limits&lt;int&gt;::min()+1;
<a name="l00171"></a>00171 <span class="preprocessor">#else</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>  <span class="keywordflow">return</span> INT_MIN+1;
<a name="l00173"></a>00173 <span class="preprocessor">#endif</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>}
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="keyword">namespace </span>internal
<a name="l00178"></a>00178 {
<a name="l00180"></a>00180 
<a name="l00194"></a><a class="code" href="a00085.html">00194</a> <span class="keyword">class </span>PQXX_LIBEXPORT <a class="code" href="a00085.html" title="Cursor with SQL positioning semantics.">sql_cursor</a> : <span class="keyword">public</span> <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196 <span class="keyword">public</span>:
<a name="l00197"></a>00197   <a class="code" href="a00085.html" title="Cursor with SQL positioning semantics.">sql_cursor</a>(<a class="code" href="a00104.html">transaction_base</a> &amp;t,
<a name="l00198"></a>00198         <span class="keyword">const</span> PGSTD::string &amp;query,
<a name="l00199"></a>00199         <span class="keyword">const</span> PGSTD::string &amp;cname,
<a name="l00200"></a>00200         <a class="code" href="a00030.html#a591ac7d2302288890c04e6159eb6d30e" title="Cursor access-pattern policy.">cursor_base::accesspolicy</a> ap,
<a name="l00201"></a>00201         <a class="code" href="a00030.html#aba6fa56f1ef2d25c3c73240de6b9c212" title="Cursor update policy.">cursor_base::updatepolicy</a> up,
<a name="l00202"></a>00202         <a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330" title="Cursor destruction policy.">cursor_base::ownershippolicy</a> op,
<a name="l00203"></a>00203         <span class="keywordtype">bool</span> hold);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <a class="code" href="a00085.html" title="Cursor with SQL positioning semantics.">sql_cursor</a>(<a class="code" href="a00104.html">transaction_base</a> &amp;t,
<a name="l00206"></a>00206         <span class="keyword">const</span> PGSTD::string &amp;cname,
<a name="l00207"></a>00207         <a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330" title="Cursor destruction policy.">cursor_base::ownershippolicy</a> op);
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="a00085.html#a5957a76f8d79ad8eae5feee9722eff40">00209</a>   <a class="code" href="a00085.html#a5957a76f8d79ad8eae5feee9722eff40">~sql_cursor</a>() throw () { close(); }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> fetch(difference_type rows, difference_type &amp;displacement);
<a name="l00212"></a><a class="code" href="a00085.html#a7c17e5396e312c2f3e0f66db3d0e4a90">00212</a>   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> fetch(<a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> rows)
<a name="l00213"></a>00213                                 { <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> d=0; <span class="keywordflow">return</span> <a class="code" href="a00085.html#a7c17e5396e312c2f3e0f66db3d0e4a90">fetch</a>(rows, d); }
<a name="l00214"></a>00214   difference_type move(difference_type rows, difference_type &amp;displacement);
<a name="l00215"></a><a class="code" href="a00085.html#a31a9e2e6f5276c06120111df47f9ac5f">00215</a>   <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> move(<a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> rows)
<a name="l00216"></a>00216                                 { <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> d=0; <span class="keywordflow">return</span> <a class="code" href="a00085.html#a31a9e2e6f5276c06120111df47f9ac5f">move</a>(rows, d); }
<a name="l00217"></a>00217 
<a name="l00219"></a>00219 
<a name="l00225"></a><a class="code" href="a00085.html#a5a8ff4f51d2a249f1e772e0953452684">00225</a>   <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> <a class="code" href="a00085.html#a5a8ff4f51d2a249f1e772e0953452684" title="Current position, or -1 for unknown.">pos</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_pos; }
<a name="l00226"></a>00226 
<a name="l00228"></a>00228 
<a name="l00234"></a><a class="code" href="a00085.html#a3ae9feae24d5eab6cf30867351cee54e">00234</a>   <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">difference_type</a> <a class="code" href="a00085.html#a3ae9feae24d5eab6cf30867351cee54e" title="End position, or -1 for unknown.">endpos</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_endpos; }
<a name="l00235"></a>00235 
<a name="l00237"></a><a class="code" href="a00085.html#af02410eca37436cb84547357d0b5a38e">00237</a>   <span class="keyword">const</span> <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> &amp;<a class="code" href="a00085.html#af02410eca37436cb84547357d0b5a38e" title="Return zero-row result for this cursor.">empty_result</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_empty_result; }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keywordtype">void</span> close() throw ();
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 private:
<a name="l00242"></a>00242   difference_type adjust(difference_type hoped, difference_type actual);
<a name="l00243"></a>00243   static PGSTD::<span class="keywordtype">string</span> stridestring(difference_type);
<a name="l00245"></a>00245   <span class="keywordtype">void</span> init_empty_result(<a class="code" href="a00104.html">transaction_base</a> &amp;);
<a name="l00246"></a>00246 
<a name="l00248"></a>00248   <a class="code" href="a00023.html" title="connection_base abstract base class; represents a connection to a database.">connection_base</a> &amp;m_home;
<a name="l00249"></a>00249 
<a name="l00251"></a>00251   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> m_empty_result;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> m_cached_current_row;
<a name="l00254"></a>00254 
<a name="l00256"></a>00256   <span class="keywordtype">bool</span> m_adopted;
<a name="l00257"></a>00257 
<a name="l00259"></a>00259   <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>::ownershippolicy m_ownership;
<a name="l00260"></a>00260 
<a name="l00262"></a>00262   <span class="keywordtype">int</span> m_at_end;
<a name="l00263"></a>00263 
<a name="l00265"></a>00265   difference_type m_pos;
<a name="l00266"></a>00266 
<a name="l00268"></a>00268   difference_type m_endpos;
<a name="l00269"></a>00269 };
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a>::size_type PQXX_LIBEXPORT <a class="code" href="a00194.html#a1d4ccde33cf0aa77b96d2dd358235f25">obtain_stateless_cursor_size</a>(<a class="code" href="a00085.html" title="Cursor with SQL positioning semantics.">sql_cursor</a> &amp;);
<a name="l00273"></a>00273 <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> PQXX_LIBEXPORT <a class="code" href="a00194.html#aeeea06390ffa0def35db2d8bd524c671">stateless_cursor_retrieve</a>(
<a name="l00274"></a>00274         sql_cursor &amp;,
<a name="l00275"></a>00275         <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a>::difference_type size,
<a name="l00276"></a>00276         <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a>::difference_type begin_pos,
<a name="l00277"></a>00277         <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a>::difference_type end_pos);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 } <span class="comment">// namespace internal</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00283"></a>00283 
<a name="l00289"></a>00289 template&lt;<a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>::updatepolicy up, <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>::ownershippolicy op&gt;
<a name="l00290"></a><a class="code" href="a00087.html">00290</a> class <a class="code" href="a00087.html" title="&quot;Stateless cursor&quot; class: easy API for retrieving parts of result sets">stateless_cursor</a>
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292 <span class="keyword">public</span>:
<a name="l00293"></a><a class="code" href="a00087.html#a85ee6b4652b659565fede97bb00b4232">00293</a>   <span class="keyword">typedef</span> <a class="code" href="a00082.html#a9e02bbf1126802fd7fd64df989e03940">result::size_type</a> <a class="code" href="a00087.html#a85ee6b4652b659565fede97bb00b4232">size_type</a>;
<a name="l00294"></a><a class="code" href="a00087.html#af9cfc40abd39a68880b0df6d618e41fb">00294</a>   <span class="keyword">typedef</span> <a class="code" href="a00082.html#abec7f7f4d7ed030f38b2a123b632b818">result::difference_type</a> <a class="code" href="a00087.html#af9cfc40abd39a68880b0df6d618e41fb">difference_type</a>;
<a name="l00295"></a>00295 
<a name="l00297"></a><a class="code" href="a00087.html#aa042b1c72b16911a4f2e1c73be3d8942">00297</a>   stateless_cursor(
<a name="l00298"></a>00298         transaction_base &amp;trans,
<a name="l00299"></a>00299         <span class="keyword">const</span> PGSTD::string &amp;query,
<a name="l00300"></a>00300         <span class="keyword">const</span> PGSTD::string &amp;cname,
<a name="l00301"></a>00301         <span class="keywordtype">bool</span> hold) :
<a name="l00302"></a>00302     m_cur(trans, query, cname, <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>::random_access, up, op, hold)
<a name="l00303"></a>00303   {
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 
<a name="l00307"></a><a class="code" href="a00087.html#a8231490bf29aa7686c4daa3b1fc97ed1">00307</a>   stateless_cursor(
<a name="l00308"></a>00308         transaction_base &amp;trans,
<a name="l00309"></a>00309         <span class="keyword">const</span> PGSTD::string adopted_cursor) :
<a name="l00310"></a>00310     m_cur(trans, adopted_cursor, op)
<a name="l00311"></a>00311   {
<a name="l00312"></a>00312     <span class="comment">// Put cursor in known position</span>
<a name="l00313"></a>00313     m_cur.move(<a class="code" href="a00030.html#ae1e1a28e596a78fa8ed8c4eeccbe6369" title="Special value: read backwards from current position back to origin.">cursor_base::backward_all</a>());
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="a00087.html#a20a0b658655a3b10543abd35717dd633">00316</a>   <span class="keywordtype">void</span> <a class="code" href="a00087.html#a20a0b658655a3b10543abd35717dd633">close</a>() throw () { m_cur.close(); }
<a name="l00317"></a>00317 
<a name="l00319"></a>00319 
<a name="l00322"></a><a class="code" href="a00087.html#ae278f24bab98d3946061934a48992067">00322</a>   size_type <a class="code" href="a00087.html#ae278f24bab98d3946061934a48992067" title="Number of rows in cursor&#39;s result set.">size</a>() { <span class="keywordflow">return</span> <a class="code" href="a00194.html#a1d4ccde33cf0aa77b96d2dd358235f25">internal::obtain_stateless_cursor_size</a>(m_cur); }
<a name="l00323"></a>00323 
<a name="l00325"></a>00325 
<a name="l00336"></a><a class="code" href="a00087.html#a97046479f709ae621473c48ed7a0932d">00336</a>   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> retrieve(difference_type begin_pos, difference_type end_pos)
<a name="l00337"></a>00337   {
<a name="l00338"></a>00338     <span class="keywordflow">return</span> <a class="code" href="a00194.html#aeeea06390ffa0def35db2d8bd524c671">internal::stateless_cursor_retrieve</a>(
<a name="l00339"></a>00339         m_cur,
<a name="l00340"></a>00340         <a class="code" href="a00082.html#abec7f7f4d7ed030f38b2a123b632b818">result::difference_type</a>(size()),
<a name="l00341"></a>00341         begin_pos,
<a name="l00342"></a>00342         end_pos);
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344 
<a name="l00345"></a><a class="code" href="a00087.html#a9b99a8f9ef260f11a32b29e917bdacda">00345</a>   <span class="keyword">const</span> PGSTD::string &amp;<a class="code" href="a00087.html#a9b99a8f9ef260f11a32b29e917bdacda">name</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_cur.name(); }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="keyword">private</span>:
<a name="l00348"></a>00348   <a class="code" href="a00085.html" title="Cursor with SQL positioning semantics.">internal::sql_cursor</a> m_cur;
<a name="l00349"></a>00349 };
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="keyword">class </span>icursor_iterator;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keyword">namespace </span>internal
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357 <span class="keyword">namespace </span>gate
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359 <span class="keyword">class </span>icursor_iterator_icursorstream;
<a name="l00360"></a>00360 <span class="keyword">class </span>icursorstream_icursor_iterator;
<a name="l00361"></a>00361 } <span class="comment">// namespace internal::gate</span>
<a name="l00362"></a>00362 } <span class="comment">// namespace internal</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 
<a name="l00366"></a>00366 
<a name="l00381"></a><a class="code" href="a00044.html">00381</a> <span class="keyword">class </span>PQXX_LIBEXPORT <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a>
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383 <span class="keyword">public</span>:
<a name="l00384"></a><a class="code" href="a00044.html#a6f29a9a658eeb39c09075bfc655c5d90">00384</a>   <span class="keyword">typedef</span> <a class="code" href="a00030.html#a732bb16c01dc3266d424267252d4f1b0">cursor_base::size_type</a> <a class="code" href="a00044.html#a6f29a9a658eeb39c09075bfc655c5d90">size_type</a>;
<a name="l00385"></a><a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">00385</a>   <span class="keyword">typedef</span> <a class="code" href="a00030.html#a746c725327e1dfd598708bfeb8834992">cursor_base::difference_type</a> <a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">difference_type</a>;
<a name="l00386"></a>00386 
<a name="l00388"></a>00388 
<a name="l00399"></a>00399   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a>(<a class="code" href="a00104.html">transaction_base</a> &amp;context,
<a name="l00400"></a>00400       <span class="keyword">const</span> PGSTD::string &amp;query,
<a name="l00401"></a>00401       <span class="keyword">const</span> PGSTD::string &amp;basename,
<a name="l00402"></a>00402       <a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">difference_type</a> sstride=1);                                       <span class="comment">//[t81]</span>
<a name="l00403"></a>00403 
<a name="l00405"></a>00405 
<a name="l00429"></a>00429   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a>(<a class="code" href="a00104.html">transaction_base</a> &amp;context,
<a name="l00430"></a>00430       <span class="keyword">const</span> <a class="code" href="a00040.html" title="Reference to a field in a result set.">field</a> &amp;cname,
<a name="l00431"></a>00431       <a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">difference_type</a> sstride=1,
<a name="l00432"></a>00432       <a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330" title="Cursor destruction policy.">cursor_base::ownershippolicy</a> op=<a class="code" href="a00030.html#a8d5f8214ede2ab27dd588defc2847330a3ace6a7a5ca4ec3b486f2f35fd2420b0" title="Destroy SQL cursor when cursor object is closed at end of transaction.">cursor_base::owned</a>);              <span class="comment">//[t84]</span>
<a name="l00433"></a>00433 
<a name="l00434"></a><a class="code" href="a00044.html#a462bf00fed476b503116f1c769deeb2f">00434</a>   <a class="code" href="a00044.html#a462bf00fed476b503116f1c769deeb2f">operator bool</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> !m_done; }
<a name="l00435"></a>00435 
<a name="l00437"></a>00437 
<a name="l00443"></a><a class="code" href="a00044.html#a0602dd0f6ed2641bbb98ad584bcf60e7">00443</a>   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a> &amp;<span class="keyword">get</span>(<a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> &amp;res) { res = fetchblock(); <span class="keywordflow">return</span> *<span class="keyword">this</span>; } <span class="comment">//[t81]</span>
<a name="l00445"></a>00445 <span class="comment"></span>
<a name="l00451"></a><a class="code" href="a00044.html#a7ac105c3e882661d8f1220ccf9164c27">00451</a>   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a> &amp;<a class="code" href="a00044.html#a7ac105c3e882661d8f1220ccf9164c27" title="Read new value into given result object; same as get(result &amp;)">operator&gt;&gt;</a>(<a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> &amp;res) { <span class="keywordflow">return</span> <span class="keyword">get</span>(res); }           <span class="comment">//[t81]</span>
<a name="l00452"></a>00452 
<a name="l00454"></a>00454 
<a name="l00458"></a>00458   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a> &amp;ignore(PGSTD::streamsize n=1);                         <span class="comment">//[t81]</span>
<a name="l00459"></a>00459 
<a name="l00461"></a>00461 
<a name="l00464"></a>00464   <span class="keywordtype">void</span> set_stride(difference_type stride);                              <span class="comment">//[t81]</span>
<a name="l00465"></a><a class="code" href="a00044.html#a89f9c7dc295e4befa9bdbd2bfedbe800">00465</a>   <a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">difference_type</a> <a class="code" href="a00044.html#a89f9c7dc295e4befa9bdbd2bfedbe800">stride</a>() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_stride; }          <span class="comment">//[t81]</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="keyword">private</span>:
<a name="l00468"></a>00468   <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a> fetchblock();
<a name="l00469"></a>00469 
<a name="l00470"></a><a class="code" href="a00044.html#a81bc68e9ddb56368929d58e0820e72f0">00470</a>   <span class="keyword">friend</span> <span class="keyword">class </span>internal::gate::icursorstream_icursor_iterator;
<a name="l00471"></a>00471   <a class="code" href="a00044.html#a6f29a9a658eeb39c09075bfc655c5d90">size_type</a> forward(<a class="code" href="a00044.html#a6f29a9a658eeb39c09075bfc655c5d90">size_type</a> n=1);
<a name="l00472"></a>00472   <span class="keywordtype">void</span> insert_iterator(<a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> *) throw ();
<a name="l00473"></a>00473   <span class="keywordtype">void</span> remove_iterator(<a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> *) const throw ();
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="keywordtype">void</span> service_iterators(<a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">difference_type</a>);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   internal::sql_cursor m_cur;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   difference_type m_stride;
<a name="l00480"></a>00480   difference_type m_realpos, m_reqpos;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   mutable <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> *m_iterators;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   <span class="keywordtype">bool</span> m_done;
<a name="l00485"></a>00485 };
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00489"></a>00489 
<a name="l00515"></a><a class="code" href="a00043.html">00515</a> class PQXX_LIBEXPORT <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> :
<a name="l00516"></a>00516   public PGSTD::iterator&lt;PGSTD::input_iterator_tag,
<a name="l00517"></a>00517         <a class="code" href="a00082.html" title="Result set containing data returned by a query or command.">result</a>,
<a name="l00518"></a>00518         <a class="code" href="a00030.html" title="Common definitions for cursor types.">cursor_base</a>::<a class="code" href="a00043.html#af82ad1f395b1ccef2f48e7a04e315ae2">size_type</a>,
<a name="l00519"></a>00519         const result *,
<a name="l00520"></a>00520         const result &amp;&gt;
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522 <span class="keyword">public</span>:
<a name="l00523"></a><a class="code" href="a00043.html#a4d6d50111eed016d1ce28bbdbbf96862">00523</a>   <span class="keyword">typedef</span> <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a> <a class="code" href="a00043.html#a4d6d50111eed016d1ce28bbdbbf96862">istream_type</a>;
<a name="l00524"></a><a class="code" href="a00043.html#af82ad1f395b1ccef2f48e7a04e315ae2">00524</a>   <span class="keyword">typedef</span> <a class="code" href="a00044.html#a6f29a9a658eeb39c09075bfc655c5d90">istream_type::size_type</a> <a class="code" href="a00043.html#af82ad1f395b1ccef2f48e7a04e315ae2">size_type</a>;
<a name="l00525"></a><a class="code" href="a00043.html#acf5bea0afb3ae6a669bd40cd659a5921">00525</a>   <span class="keyword">typedef</span> <a class="code" href="a00044.html#a79c9e623be28567215d88087cd7e80d0">istream_type::difference_type</a> <a class="code" href="a00043.html#acf5bea0afb3ae6a669bd40cd659a5921">difference_type</a>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a>() throw ();                                          <span class="comment">//[t84]</span>
<a name="l00528"></a>00528   explicit <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a>(istream_type &amp;) throw ();                   <span class="comment">//[t84]</span>
<a name="l00529"></a>00529   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a>(const <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;) throw ();                  <span class="comment">//[t84]</span>
<a name="l00530"></a>00530   ~<a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a>() throw ();
<a name="l00531"></a>00531 
<a name="l00532"></a><a class="code" href="a00043.html#a7c416cd5efae357cce5f6dccf6d6fb58">00532</a>   const result &amp;operator*()<span class="keyword"> const </span>{ refresh(); <span class="keywordflow">return</span> m_here; }         <span class="comment">//[t84]</span>
<a name="l00533"></a><a class="code" href="a00043.html#af2c977a93c27c468244f43733f7238c6">00533</a>   <span class="keyword">const</span> result *<a class="code" href="a00043.html#af2c977a93c27c468244f43733f7238c6">operator-&gt;</a>()<span class="keyword"> const </span>{ refresh(); <span class="keywordflow">return</span> &amp;m_here; }       <span class="comment">//[t84]</span>
<a name="l00534"></a>00534   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;operator++();                                       <span class="comment">//[t84]</span>
<a name="l00535"></a>00535   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> operator++(<span class="keywordtype">int</span>);                                     <span class="comment">//[t84]</span>
<a name="l00536"></a>00536   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;operator+=(difference_type);                        <span class="comment">//[t84]</span>
<a name="l00537"></a>00537   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;operator=(<span class="keyword">const</span> <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;) throw ();       <span class="comment">//[t84]</span>
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="keywordtype">bool</span> operator==(const <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) const;                   <span class="comment">//[t84]</span>
<a name="l00540"></a><a class="code" href="a00043.html#ad0cda8bc84e80e331d2fcc973788d99a">00540</a>   <span class="keywordtype">bool</span> operator!=(const <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) const throw ()           <span class="comment">//[t84]</span>
<a name="l00541"></a>00541         { <span class="keywordflow">return</span> !operator==(rhs); }
<a name="l00542"></a>00542   <span class="keywordtype">bool</span> operator&lt;(<span class="keyword">const</span> <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) <span class="keyword">const</span>;                    <span class="comment">//[t84]</span>
<a name="l00543"></a><a class="code" href="a00043.html#a0844bc4574d839c13d9ae6f2316a7286">00543</a>   <span class="keywordtype">bool</span> operator&gt;(<span class="keyword">const</span> <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) <span class="keyword">const</span>                     <span class="comment">//[t84]</span>
<a name="l00544"></a>00544         { <span class="keywordflow">return</span> rhs &lt; *<span class="keyword">this</span>; }
<a name="l00545"></a><a class="code" href="a00043.html#a6afd533edcdf0e9f9667fdde547de63a">00545</a>   <span class="keywordtype">bool</span> operator&lt;=(<span class="keyword">const</span> <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) <span class="keyword">const</span>                    <span class="comment">//[t84]</span>
<a name="l00546"></a>00546         { <span class="keywordflow">return</span> !(*<span class="keyword">this</span> &gt; rhs); }
<a name="l00547"></a><a class="code" href="a00043.html#a0abd27b596021390729199ddcb5a4baf">00547</a>   <span class="keywordtype">bool</span> operator&gt;=(<span class="keyword">const</span> <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> &amp;rhs) <span class="keyword">const</span>                    <span class="comment">//[t84]</span>
<a name="l00548"></a>00548         { <span class="keywordflow">return</span> !(*<span class="keyword">this</span> &lt; rhs); }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="keyword">private</span>:
<a name="l00551"></a>00551   <span class="keywordtype">void</span> refresh() <span class="keyword">const</span>;
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="a00043.html#a50ae5821478a2398f50c8cf2c42a0343">00553</a>   <span class="keyword">friend</span> <span class="keyword">class </span>internal::gate::icursor_iterator_icursorstream;
<a name="l00554"></a>00554   difference_type pos() <span class="keyword">const</span> throw () { <span class="keywordflow">return</span> m_pos; }
<a name="l00555"></a>00555   <span class="keywordtype">void</span> fill(<span class="keyword">const</span> result &amp;);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557   <a class="code" href="a00044.html" title="Simple read-only cursor represented as a stream of results.">icursorstream</a> *m_stream;
<a name="l00558"></a>00558   result m_here;
<a name="l00559"></a>00559   difference_type m_pos;
<a name="l00560"></a>00560   <a class="code" href="a00043.html" title="Approximate istream_iterator for icursorstream.">icursor_iterator</a> *m_prev, *m_next;
<a name="l00561"></a>00561 };
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 } <span class="comment">// namespace pqxx</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="preprocessor">#include &quot;pqxx/compiler-internal-post.hxx&quot;</span>
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="preprocessor">#endif</span>
<a name="l00569"></a>00569 <span class="preprocessor"></span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>cursor.hxx</b>      </li>
      <li class="footer">Generated on Sun Nov 27 2011 18:14:12 for libpqxx by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
