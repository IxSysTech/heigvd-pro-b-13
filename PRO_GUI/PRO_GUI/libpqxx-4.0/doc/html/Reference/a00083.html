<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libpqxx: pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libpqxx&#160;<span id="projectnumber">4.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('a00083.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt; Class Template Reference<div class="ingroups"><a class="el" href="a00205.html">Transaction classes</a></div></div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="pqxx::robusttransaction" --><!-- doxytag: inherits="pqxx::basic_robusttransaction" -->
<p>Slightly slower, better-fortified version of transaction.  
 <a href="a00083.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00158_source.html">robusttransaction.hxx</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="a00350.png" border="0" usemap="#pqxx_1_1robusttransaction_3_01ISOLATIONLEVEL_01_4_inherit__map" alt="Inheritance graph"/></div>
<map name="pqxx_1_1robusttransaction_3_01ISOLATIONLEVEL_01_4_inherit__map" id="pqxx_1_1robusttransaction_3_01ISOLATIONLEVEL_01_4_inherit__map">
<area shape="rect" id="node2" href="a00011.html" title="pqxx::basic_robusttransaction" alt="" coords="55,237,249,267"/><area shape="rect" id="node4" href="a00032.html" title="pqxx::dbtransaction" alt="" coords="84,160,220,189"/><area shape="rect" id="node6" href="a00104.html" title="pqxx::transaction_base" alt="" coords="73,83,231,112"/><area shape="rect" id="node8" href="a00059.html" title="pqxx::internal::namedclass" alt="" coords="63,5,241,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00351.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="a00054.html">isolation_traits</a><br class="typebreak"/>
&lt; ISOLATIONLEVEL &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00083.html#a8fb228809bd42b2936ada9f9573d30d6">isolation_tag</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Isolation level is read_committed by default.  <a href="#a8fb228809bd42b2936ada9f9573d30d6"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00083.html#ae28452f4e178b6c548f6294fee803632">robusttransaction</a> (<a class="el" href="a00023.html">connection_base</a> &amp;C, const std::string &amp;Name=std::string())</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#ae28452f4e178b6c548f6294fee803632"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00083.html#af1b175fd37479937c936f172803f40bb">~robusttransaction</a> ()  throw ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><h3>template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt;<br/>
class pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt;</h3>

<p>Slightly slower, better-fortified version of transaction. </p>
<p>robusttransaction is similar to transaction, but spends more effort (and performance!) to deal with the hopefully rare case that the connection to the backend is lost just as the current transaction is being committed. In this case, there is no way to determine whether the backend managed to commit the transaction before noticing the loss of connection.</p>
<p>In such cases, this class tries to reconnect to the database and figure out what happened. It will need to store and manage some information (pretty much a user-level transaction log) in the back-end for each and every transaction just on the off chance that this problem might occur. This service level was made optional since you may not want to pay this overhead where it is not necessary. Certainly the use of this class makes no sense for local connections, or for transactions that read the database but never modify it, or for noncritical database manipulations.</p>
<p>Besides being slower, it's theoretically possible that robusttransaction actually fails more instead of less often than a normal transaction. This is due to the added work and complexity. What robusttransaction tries to achieve is to be more deterministic, not more successful per se.</p>
<p>When a user first uses a robusttransaction in a database, the class will attempt to create a log table there to keep vital transaction-related state information in. This table, located in that same database, will be called pqxxlog_*user*, where *user* is the PostgreSQL username for that user. If the log table can not be created, the transaction fails immediately.</p>
<p>If the user does not have permission to create the log table, the database administrator may create one for him beforehand, and give ownership (or at least full insert/update rights) to the user. The table must contain two non-unique fields (which will never be null): "name" (of text type, <code>varchar(256)</code> by default) and "date" (of <code>timestamp</code> type). Older versions of robusttransaction also added a unique "id" field; this field is now obsolete and the log table's implicit oids are used instead. The log tables' names may be made configurable in a future version of libpqxx.</p>
<p>The transaction log table contains records describing unfinished transactions, i.e. ones that have been started but not, as far as the client knows, committed or aborted. This can mean any of the following:</p>
<ol>
<li>
The transaction is in progress. Since backend transactions can't run for extended periods of time, this can only be the case if the log record's timestamp (compared to the server's clock) is not very old, provided of course that the server's system clock hasn't just made a radical jump. </li>
<li>
The client's connection to the server was lost, just when the client was committing the transaction, and the client so far has not been able to re-establish the connection to verify whether the transaction was actually completed or rolled back by the server. This is a serious (and luckily a rare) condition and requires manual inspection of the database to determine what happened. The robusttransaction will emit clear and specific warnings to this effect, and will identify the log record describing the transaction in question. </li>
<li>
The transaction was completed (either by commit or by rollback), but the client's connection was durably lost just as it tried to clean up the log record. Again, robusttransaction will emit a clear and specific warning to tell you about this and request that the record be deleted as soon as possible. </li>
<li>
The client has gone offline at any time while in one of the preceding states. This also requires manual intervention, but the client obviously is not able to issue a warning. </li>
</ol>
<p>It is safe to drop a log table when it is not in use (ie., it is empty or all records in it represent states 2-4 above). Each robusttransaction will attempt to recreate the table at its next time of use. </p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a8fb228809bd42b2936ada9f9573d30d6"></a><!-- doxytag: member="pqxx::robusttransaction::isolation_tag" ref="a8fb228809bd42b2936ada9f9573d30d6" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="a00054.html">isolation_traits</a>&lt;ISOLATIONLEVEL&gt; <a class="el" href="a00083.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::<a class="el" href="a00054.html">isolation_tag</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Isolation level is read_committed by default. </p>

<p>Reimplemented from <a class="el" href="a00011.html#aad0757a015b2ddfe476e3d83f812bbff">pqxx::basic_robusttransaction</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae28452f4e178b6c548f6294fee803632"></a><!-- doxytag: member="pqxx::robusttransaction::robusttransaction" ref="ae28452f4e178b6c548f6294fee803632" args="(connection_base &amp;C, const std::string &amp;Name=std::string())" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00083.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::<a class="el" href="a00083.html">robusttransaction</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00023.html">connection_base</a> &amp;&#160;</td>
          <td class="paramname"><em>C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>Name</em> = <code>std::string()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [explicit]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Constructor. </p>
<p>Creates robusttransaction of given name </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">C</td><td>Connection that this robusttransaction should live inside. </td></tr>
    <tr><td class="paramname">Name</td><td>optional human-readable name for this transaction </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af1b175fd37479937c936f172803f40bb"></a><!-- doxytag: member="pqxx::robusttransaction::~robusttransaction" ref="af1b175fd37479937c936f172803f40bb" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="a00083.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::~<a class="el" href="a00083.html">robusttransaction</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>  throw ()<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="a00158_source.html">robusttransaction.hxx</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="a00176.html">pqxx</a>      </li>
      <li class="navelem"><a class="el" href="a00083.html">robusttransaction</a>      </li>
      <li class="footer">Generated on Sun Nov 27 2011 18:14:13 for libpqxx by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
